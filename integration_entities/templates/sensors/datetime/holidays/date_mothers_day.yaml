---
# platform: rest
# name: date_mothers
# resource: !secret wolframalpha_date_mothers
# scan_interval: 2592000 # 86400 seconds * 30 days
# value_template: "{{ value|replace(' (Unix time)','')|int(default=0)|timestamp_custom('%Y-%m-%d') }}"
unique_id: date_mothers
name: "Mother's day"
icon: mdi:human-female-boy
state: |
  {%- from "date_helpers.jinja" import nth_day_of_month %}

  {%- set event_nth_day = 2 -%}
  {%- set event_day_of_week = "Sunday" -%}
  {%- set event_month = 5 -%}

  {%- set today = as_datetime(states("sensor.date")) -%}

  {#- Calculate the event for the current year. #}
  {%- set event_date = nth_day_of_month(event_nth_day, event_day_of_week, event_month, today.year) | replace("00:00:00","") -%}

  {#- If the event has passed for this year, get next year's event. #}
  {%- set event_day = event_date.split('-')[2]|int(default=0) -%}
  {%- if event_month < today.month -%}
    {%- set event_date = nth_day_of_month(event_nth_day, event_day_of_week, event_month, today.year+1) | replace("00:00:00","")  -%}
  {%- elif event_month == today.month and event_day < today.day %}
    {%- set event_date = nth_day_of_month(event_nth_day, event_day_of_week, event_month, today.year+1) | replace("00:00:00","")  -%}
  {%- endif -%}

  {{- event_date|trim }}
attributes:
  type: Holiday
  friendly_date: |
    {%- set event_date = this.state %}
    {%- if event_date is defined and event_date|lower not in ["","none","unknown","unavailable"] %}
      {%- set event_month = as_timestamp(event_date) | timestamp_custom("%B") %}
      {{ event_month ~ " {:2}, {:4}".format(event_date.split("-")[2]|int(default=0), event_date.split("-")[0]|int(default=0)) }}
    {%- endif %}
