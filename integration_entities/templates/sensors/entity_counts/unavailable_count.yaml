---
unique_id: unavailable_count
name: Unavailable count
icon: mdi:alert
state_class: total
state: |
  {{ this.attributes.entities|default("")|count }}
attributes:
  entities: |
    {%- set excluded_entities = ["camera.glowforge"] %}
    {%- set entities = states | selectattr("state","eq","unavailable")
      | rejectattr("entity_id","in",excluded_entities)
      | map(attribute="entity_id")
      | reject("is_hidden_entity")
      | reject("in",integration_entities("google_home"))
      | reject("in",integration_entities("HASS Agent"))
      | reject("in",integration_entities("Octoprint"))
      | reject("in",integration_entities("Sensibo"))
      | reject("in",integration_entities("UPnP Availability"))
      | reject("in",integration_entities("uptime_kuma"))
      | reject("in",integration_entities("Watchman"))
      | list %}
    {{ entities }}
