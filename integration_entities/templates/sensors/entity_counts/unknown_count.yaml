---
unique_id: unknown_count
name: Unknown count
icon: mdi:help-rhombus
state_class: total
state: |
  {{ this.attributes.entities|default("")|count }}
attributes:
  entities: |
    {%- set excluded_domains = ["button"] %}
    {%- set excluded_entities = ["group.safety_alarms","sensor.blackpc_lastboot","sensor.blackpc_volume"] %}
    {%- set entities = states | selectattr("state","eq","unknown")
      | rejectattr("domain","in",excluded_domains)
      | rejectattr("entity_id","in",excluded_entities)
      | map(attribute="entity_id")
      | reject("is_hidden_entity")
      | reject("in",integration_entities("HASS Agent"))
      | reject("in",integration_entities("Octoprint"))
      | reject("in",integration_entities("person"))
      | reject("in",integration_entities("Sensibo"))
      | reject("in",integration_entities("upnp_availability"))
      | reject("in",integration_entities("Watchman"))
      | reject("in",integration_entities("Z-Wave JS"))
      | list %}
    {{ entities }}
