---
unique_id: windows_open
name: Windows open
icon: mdi:window-open
state_class: total
state: |
  {%- if this is not defined or this.attributes is not defined or this.attributes.entities is not defined %}
    0
  {%- else %}
    {{ this.attributes.entities | default([]) | count | default(0) }}
  {%- endif %}
attributes:
  entities: |
    {%-
      set all_windows = state_attr("binary_sensor.downstairs_windows","entity_id")
        + state_attr("binary_sensor.upstairs_windows","entity_id")
    %}
    {{
      states.binary_sensor
      | selectattr("entity_id","in", all_windows)
      | selectattr("state","eq","on")
      | rejectattr("state","eq","unavailable")
      | rejectattr("state","eq","unknown")
      | map(attribute="entity_id")
      | list
      | sort
    }}
